---
import Layout from '../layouts/Layout.astro';
import CoverImage from '../components/CoverImage.astro';
import { getCollection } from 'astro:content';

// Get latest content
const mixes = await getCollection('mixes');
mixes.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const latestMixes = mixes.slice(0, 3);

const conversations = await getCollection('conversations');
conversations.sort((a, b) => b.data.number - a.data.number);
const latestConversations = conversations.slice(0, 3);

const archives = await getCollection('archive');
archives.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const latestArchives = archives.slice(0, 2);
---

<Layout title="Places" variant="wide">
    <div class="mb-8">
      <h1 class="text-2xl mb-4">Places</h1>
      <p class="text-gray-700 mb-8">
        Hamilton DJ collective. Democratizing DJ practices and music education.
      </p>
    </div>

    <div class="space-y-12">
      <section>
        <h2 class="text-lg mb-4">Latest Mixes</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {latestMixes.map((mix) => (
            <div class="group">
              <a href={`/mixes/${mix.slug}`} class="block">
                <div class="mb-3">
                  <CoverImage 
                    collection="mixes"
                    slug={mix.slug}
                    cover={mix.data.cover}
                    alt={`${mix.data.title} by ${mix.data.artist}`}
                    class="w-full"
                  />
                </div>
                <h3 class="text-lg mb-1 group-hover:text-gray-700">
                  {mix.data.title}
                </h3>
                <p class="text-sm text-gray-700 mb-1">{mix.data.artist}</p>
                <p class="text-xs text-gray-500">
                  {mix.data.date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short'
                  })}
                </p>
              </a>
            </div>
          ))}
        </div>
        <p class="text-xs text-gray-500 mt-4">
          <a href="/mixes" class="hover:text-black">All mixes →</a>
        </p>
      </section>

      <section>
        <h2 class="text-lg mb-4">Latest Conversations</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {latestConversations.map((convo) => (
            <div class="group">
              <a href={`/convo/${convo.slug}`} class="block">
                <div class="mb-3">
                  {convo.data.cover ? (
                    <CoverImage 
                      collection="conversations"
                      slug={convo.slug}
                      cover={convo.data.cover}
                      alt={`Conversation ${convo.data.number}: ${convo.data.title}`}
                      class="w-full"
                    />
                  ) : (
                    <div class="aspect-square bg-gray-100 w-full">
                    </div>
                  )}
                </div>
                <h3 class="text-lg mb-1 group-hover:text-gray-700">
                  {convo.data.number.toString().padStart(3, '0')}: {convo.data.title}
                </h3>
                <p class="text-sm text-gray-700 mb-1">{convo.data.participants.join(', ')}</p>
                <p class="text-xs text-gray-500">
                  {convo.data.date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short'
                  })}
                </p>
              </a>
            </div>
          ))}
        </div>
        <p class="text-xs text-gray-500 mt-4">
          <a href="/convo" class="hover:text-black">All conversations →</a>
        </p>
      </section>

      <section>
        <h2 class="text-lg mb-4">Recent Archive</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {latestArchives.map((item) => (
            <div class="group">
              <a href={`/archive/${item.slug}`} class="block">
                <div class="mb-3">
                  {item.data.cover ? (
                    <CoverImage 
                      collection="archive"
                      slug={item.slug}
                      cover={item.data.cover}
                      alt={item.data.title}
                      class="w-full"
                    />
                  ) : (
                    <div class="aspect-square bg-gray-100 w-full">
                    </div>
                  )}
                </div>
                <h3 class="text-lg mb-1 group-hover:text-gray-700">
                  {item.data.title}
                </h3>
                <p class="text-sm text-gray-700 mb-1">{item.data.type}</p>
                <p class="text-xs text-gray-500 mb-2">
                  {item.data.description}
                </p>
              </a>
            </div>
          ))}
        </div>
        <p class="text-xs text-gray-500 mt-4">
          <a href="/archive" class="hover:text-black">All archive →</a>
        </p>
      </section>
    </div>

    <nav class="mt-12 pt-4 border-t border-gray-200">
      <p class="text-xs text-gray-500">
        <a href="/tags" class="hover:text-black">Browse by tags →</a>
      </p>
    </nav>
</Layout>
